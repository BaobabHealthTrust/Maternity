<html><head><title>Clinic Index</title><!--script type="text/javascript" language="javascript" src="/javascripts/dashboard.js" ></script--><script language="javascript" type="text/javascript" src="/touchscreentoolkit/lib/javascripts/touchScreenToolkit.js" defer></script></head><body><div id="home">
  <h1 id="project_name">
    <div style="margin-top: -10px; color: #6281A7; margin-bottom: -15px;">
      anc
      <br/>
      <span style="font-size: 12px; font-style: italic; color: #333;"><%= MATEME_VERSION %></span>
    </div>
  </h1>
  <select id="tabs">
    <option value="/clinic/overview">
      Overview
    </option>
    <% if true || current_user.activities.include?("View") %>
      <option value="/clinic/reports">
        Reports
      </option>
    <% end %>

    <% if current_user.admin?%>
      <option value="/clinic/users_tab">
        Administration
      </option>
    <% end %>

    <option value="/clinic/user_activities/?user_id=<%= current_user.user_id %>" >My Preferences</option>
  </select>

  <div id="facility"><%= @facility rescue "" %></div>
  <div id="location"><%= @location rescue "" %></div>

  <div id="date"><%= @date rescue "" %></div>
  <div id="user"><%= @user.name  rescue (@user.class.to_s  == "String" ? @user : nil) %></div>

  <select id="links">
    <option value='/logout' link='/logout'>Logout</option>
    <option value='/dde/search?gender=Female' link='/dde/search' ttSize="290px">Find / Register Patient</option>
    <option value='<%= ((session[:datetime].to_date.strftime("%Y-%m-%d") rescue Date.today.strftime("%Y-%m-%d") != 
          Date.today.strftime("%Y-%m-%d")) ?
                "/people/reset_datetime" : "/people/set_datetime") %>'  ttSize="100px">
              <%= ((session[:datetime].to_date.strftime("%Y-%m-%d") rescue Date.today.strftime("%Y-%m-%d") !=
            Date.today.strftime("%Y-%m-%d")) ? "Reset Date" : "Set Date") %></option>
  </select>

</div>
<script type="text/javascript" language="javascript">
  <!--
  tt_cancel_show = "/dde/search";
  tt_cancel_destination = "/logout";
  tt_register_destination = "/dde/search";
  //-->
</script>
    <% form_tag("/dde/process_scan_data", "method" => 'post', "enctype" => 'multipart/form-data', 
      "id" => 'dde-home', "class" => "form-horizontal", "autocomplete" => "off", "role" => "form", "novalidate" => "novalidate") do %>
      
      <textarea id="person" name="person" style="display: none;" condition="false"></textarea>
      
    <% end %>
        
    <script type="text/javascript">
      <!--

      var helpLinks = {
          "Find Patient": "<%= @settings["help_base_url"] rescue "" %>find_patient",
          "Register Patient": "<%= @settings["help_base_url"] rescue "" %>new_patient"/*,
          "Cancel": "<%= @settings["help_base_url"] rescue "" %>cancel",
          "New Person": "<%= @settings["help_base_url"] rescue "" %>add_patient",
          "Select Person": "<%= @settings["help_base_url"] rescue "" %>select_patient"*/
      };

      var json = <%= {
              "national_id" => nil,
              "application" => "#{@settings["application_name"]}",
              "site_code" => "#{@settings["site_code"]}",
              "return_path" => "http://#{request.host_with_port}/process_result",
              "names" =>
              {
                  "family_name" => nil,
                  "given_name" => nil,
                  "middle_name" => nil,
                  "maiden_name" => nil
              },
              "gender" => "#{params["gender"]}",
              "attributes" => {
                  "occupation" => nil,
                  "cell_phone_number" => nil,
                  "home_phone_number" => nil,
                  "office_phone_number" => nil,
                  "citizenship" => nil,
                  "country_of_residence" => nil,
                  "race" => nil
              },
              "birthdate" => nil,
              "patient" => {
                  "identifiers" => []
              },
              "birthdate_estimated" => nil,
              "addresses" => {
                  "current_residence" => nil,
                  "current_village" => nil,
                  "current_ta" => nil,
                  "current_district" => nil,
                  "home_village" => nil,
                  "home_ta" => nil,
                  "home_district" => nil
              }
            }.to_json %>;
  
      <% if !@settings["dde_username"].blank? %>
      
        function barcodeScanAction(){
          if(__$("barcode")){
      
              var npid = __$("barcode").value.replace("$", "");
              
              ajaxRequest(npid);
            
          }
        }
                
        function ajaxRequest(id){
          var url = "/process_data/" + id;
          
          var httpRequest = new XMLHttpRequest();
          httpRequest.onreadystatechange = function() {
              handleAjaxRequest(httpRequest);
          };
          try {
              httpRequest.open("GET", url, true);
              httpRequest.send(null);
          } catch(e){
          }
        }
        
        function handleAjaxRequest(aXMLHttpRequest){
          if (!aXMLHttpRequest) return;                    
          
          if (aXMLHttpRequest.readyState == 4 && (aXMLHttpRequest.status == 200 || 
                aXMLHttpRequest.status == 304)) {
                        
              var result = aXMLHttpRequest.responseText;
              
              __$("person").innerHTML = result; 
            
              document.getElementById("dde-home").submit();
                       
          }
        }
        
      <% end %>
      
      //-->
    </script>

    <script src="/javascripts/bht-help.js" defer></script>
</body></html>
